<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Imagiline</title>

    <link rel="shortcut icon" type="image/png" href="Icons/Imagiline.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#00ff80" />
    <meta name="description" content="An app to align your camera to a location you took a previous photo in" />

    <link rel="stylesheet" href="index.css" />
    <!-- <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script>
      eruda.init();
    </script> -->
  </head>
  <body>
    <nav>
      <label id="popupFileLabel" for="fileInput">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M14 3v4a1 1 0 0 0 1 1h4" />
          <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
          <path d="M12 11v6" />
          <path d="M9.5 13.5l2.5 -2.5l2.5 2.5" />
        </svg>
      </label>
      <input type="file" accept="image/*" id="fileInput" style="display: none" />
    </nav>

    <div class="media-container">
      <video id="live-feed" autoplay playsinline></video>
    </div>
    <div class="media-container">
      <img id="image-preview" src="" />
    </div>

    <button id="install-btn" onclick="installPWA()" style="display: none">Install App</button>

    <script type="module">
      import { squircleObserver } from "https://esm.sh/corner-smoothing";

      // Make applySquircles globally accessible
      window.applySquircles = function applySquircles() {
        // Query all elements on page
        const allElements = document.querySelectorAll("*");

        allElements.forEach((el) => {
          const style = getComputedStyle(el);
          const radius = parseFloat(style.borderRadius);

          // Only apply if it actually has a visible border radius
          if (radius > 0) {
            squircleObserver(el, {
              cornerRadius: radius,
              cornerSmoothing: 0.6,
              style: {
                fill: style.backgroundColor,
              },
            });
          }
        });
      };

      // Wait for everything to render first
      window.addEventListener("load", window.applySquircles);
    </script>
    <script src="https://cbrandolino.github.io/camvas/javascripts/camvas.js"></script>
    <script defer src="index.js"></script>
  </body>
</html>
